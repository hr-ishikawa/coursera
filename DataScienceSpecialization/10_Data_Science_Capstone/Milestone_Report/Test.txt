Katz-backoffモデル
Good-Turing スムージング

Ngram言語モデルメモ
https://jetbead.hatenablog.com/entry/20111031/1320078059
未出現事象の出現確率
https://www.slideshare.net/hirsoshnakagawa3/smoothing1-40918238
言語モデル
http://chasen.org/~daiti-m/paper/naist-dlec2004-lmodel.pdf


tkn <- function(lines){
    tibble(line=lines) %>%
    unnest_tokens(word, line) %>%
    filter(str_detect(str_sub(word,1,1),'[a-zA-Z]')) %>%
    anti_join(stop_words, by='word')
}

#tkns <- bind_rows(tkn(blog),tkn(news),tkn(twtr)) %>% 
tkns <- bind_rows(tkn(blog)) %>% 
    group_by(word) %>% summarise(n=n()) %>% filter(n>1) %>%
    distinct()

trigram <-  tkns %>% 
    mutate(trigram=str_c(word,' ',lead(word),' ',lead(word,2)),nextword=lead(word,3)) %>%
    group_by(trigram,nextword) %>% summarise(n=n()) %>%
    arrange(desc(n))

trigram %>% nrow()
trigram %>% head()
trigram %>% tail()

Q1 <- "When you breathe, I want to be the air for you. I'll be there for you, I'd live and I'd"
x <- tkn(Q1) %>% pull(word) %>% str_c(collapse=' ')
x

trigram %>% filter(trigram==x)
trigram %>% filter(str_detect(trigram,' air live'))
trigram %>% filter(str_detect(trigram,' live$'))
trigram %>% filter(str_detect(trigram,"i'd"))



x <- c('I have a pen.', 'This is a pen.', 'She is a pretty girl.', 'There is a pen in my pocket.')

str_split(x, ' |\\.') %>% unlist()%>% tibble(A=.) %>% mutate(B=lead(A)) %>% 
    filter(A!='') %>% arrange(A,B) %>% group_by(A,B) %>% summarize(N=n())
   A      B          N
   <chr>  <chr>  <int>
 1 a      pen        3
 2 a      pretty     1
 3 girl   ""         1
 4 have   a          1
 5 I      have       1
 6 in     my         1
 7 is     a          3
 8 my     pocket     1
 9 pen    ""         2
10 pen    in         1
11 pocket ""         1
12 pretty girl       1
13 She    is         1
14 There  is         1
15 This   is         1

## 2-words
str_split(x, ' |\\.') %>% unlist()%>% tibble(A=.) %>% mutate(B=lead(A),C=lead(A,2)) %>% 
    filter(A!='',B!='') %>% arrange(A,B,C) %>% group_by(A,B,C) %>% summarize(N=n())

   A      B      C          N
   <chr>  <chr>  <chr>  <int>
 1 a      pen    ""         2
 2 a      pen    in         1
 3 a      pretty girl       1
 4 have   a      pen        1
 5 I      have   a          1
 6 in     my     pocket     1
 7 is     a      pen        2
 8 is     a      pretty     1
 9 my     pocket ""         1
10 pen    in     my         1
11 pretty girl   ""         1
12 She    is     a          1
13 There  is     a          1
14 This   is     a          1

## 3-words
str_split(x, ' |\\.') %>% unlist()%>% tibble(A=.) %>% mutate(B=lead(A),C=lead(A,2),D=lead(A,3)) %>% 
    filter(A!='',B!='',C!='') %>% arrange(A,B,C,D) %>% group_by(A,B,C,D) %>% summarize(N=n())

   A     B      C      D          N
   <chr> <chr>  <chr>  <chr>  <int>
 1 a     pen    in     my         1
 2 a     pretty girl   ""         1
 3 have  a      pen    ""         1
 4 I     have   a      pen        1
 5 in    my     pocket ""         1
 6 is    a      pen    ""         1
 7 is    a      pen    in         1
 8 is    a      pretty girl       1
 9 pen   in     my     pocket     1
10 She   is     a      pretty     1
11 There is     a      pen        1
12 This  is     a      pen        1

library(tidyverse)

df <- tibble( flg=c('AA','AA','AA','AA','AA','AA','AA','AA',
                    'BB','BB','BB','BB','BB','BB','BB','BB' ),
              x  =c(  1,   2,   2,   3,   3,   4,   4,   5,
                      1,   1,   2,   2,   2,   3,   4,   5  ) )

ggplot(df,aes(x=x,fill=flg))+geom_bar(position='identity',width=1,color='black',alpha=0.4)
ggplot(df,aes(x=x,fill=flg))+geom_histogram(position='identity',bins=5,color='black',alpha=0.4)

