R predict next word
Predict Next Word - RPubs
http://www.rpubs.com/chosengmong/Final_Capstone_Project


Katz-backoffモデル
Good-Turing スムージング

Ngram言語モデルメモ
https://jetbead.hatenablog.com/entry/20111031/1320078059
未出現事象の出現確率
https://www.slideshare.net/hirsoshnakagawa3/smoothing1-40918238
言語モデル
http://chasen.org/~daiti-m/paper/naist-dlec2004-lmodel.pdf

Rのtext2vecで次の単語を予測する
https://codeday.me/jp/qa/20190821/1494469.html
単語予測アルゴリズム
https://codeday.me/jp/qa/20190220/270194.html

install.packages("hash")
library(hash)
h <- hash()
h['banana'] <- "banana"
h
h[['banana']] # [1] "banana"

install.packages("openssl")
library(openssl)
sha256("banana") # [1] "b493d48364afe44d11c0165cf470a4164d1e2609911ef998be868d46ade3de4e"

3.3 N-gram モデルのスムージング
ただし，N-gramモデルにおいてはゼロ頻度問題という
問題が存在する．これは、出現頻度により N-gram 確
率を推定すると，学習用データセット中に出現しない単語
組の確率値を 0 としてしまうという問題である．これを
解決するために，線形補間法 というスムージング手法
を用いる．線形補間法は，N-gram 確率 P(wn|w
n−1
n−N+1)
を低次の M-gram(M < N) の確率値と線形に補間する
方法である．N = 2（バイグラム）の場合は，N-gram
確率は次のようになる．
P(wn|wn−1)=λP(wn|wn−1)+(1 − λ)P(wn) (2)
ここで，λ は補間係数であり，経験的に λ = 0.7 と設定す
る．また，N = 3（トライグラム）の場合には，N-gram
確率を次のように書きなおすことができる．
P(wn|wn−2wn−1) = λ3P(wn|wn−2wn−1)
+ λ2P(wn|wn−1)
+ λ1P(wn) (3)
ここで，λ3, λ2, λ1 は，それぞれトライグラム，バイグラ
ム，ユニグラムに対する補間係数であり，∑iλi = 1 と
なるように設定される．これらの補間係数に関しては，
経験的に λ3 = 0.5, λ2 = 0.3, λ1 = 0.2 と設定する．以
降，スムージング手法についてはこれらの補間係数を用
いることとする．


精度予測　データの中からランダムに抽出


install.packages('tidytext')
library(tidytext)

lines <- c('I have a pen.', 'This is a pen.', 'She is a pretty girl.', 'There is a pen in my pocket.')
tkn <- function(lines){
    tibble(line=lines) %>%
    unnest_tokens(word, line) %>%
    filter(str_detect(str_sub(word,1,1),'[a-zA-Z]')) %>%
    anti_join(stop_words, by='word')
}
tkn(lines) %>% group_by(word) %>% summarise(n=n())
# A tibble: 4 x 2
  word       n
  <chr>  <int>
1 girl       1
2 pen        3
3 pocket     1
4 pretty     1

tkn3 <- function(lines){
    tibble(line=lines) %>%
    unnest_tokens(word, line, token='ngrams', n=3)
}
tkn3(lines)

#-----------------------------
tkn <- function(lines){
    tibble(line=lines) %>%
    mutate(line=str_c(lines,' e_o_s')) %>%
    unnest_tokens(word, line) %>%
    filter(str_detect(str_sub(word,1,1),'[a-zA-Z]')) %>%
    anti_join(stop_words, by='word')
}
words <- tkn(lines)
words
# A tibble: 10 x 1
   word  
 1 pen   
 2 e_o_s 
 3 pen   
 4 e_o_s 
 5 pretty
 6 girl  
 7 e_o_s 
 8 pen   
 9 pocket
10 e_o_s 

words %>% filter(!(word %in% c('girl','pocket')))
# A tibble: 8 x 1
  word  
1 pen   
2 e_o_s 
3 pen   
4 e_o_s 
5 pretty
6 e_o_s 
7 pen   
8 e_o_s 


#-----------------------------

#tkns <- bind_rows(tkn(blog),tkn(news),tkn(twtr)) %>% 
tkns <- bind_rows(tkn(blog)) %>% 
    group_by(word) %>% summarise(n=n()) %>% filter(n>1) %>%
    distinct()

trigram <-  tkns %>% 
    mutate(trigram=str_c(word,' ',lead(word),' ',lead(word,2)),nextword=lead(word,3)) %>%
    group_by(trigram,nextword) %>% summarise(n=n()) %>%
    arrange(desc(n))

trigram %>% nrow()
trigram %>% head()
trigram %>% tail()

Q1 <- "When you breathe, I want to be the air for you. I'll be there for you, I'd live and I'd"
x <- tkn(Q1) %>% pull(word) %>% str_c(collapse=' ')
x

trigram %>% filter(trigram==x)
trigram %>% filter(str_detect(trigram,' air live'))
trigram %>% filter(str_detect(trigram,' live$'))
trigram %>% filter(str_detect(trigram,"i'd"))



x <- c('I have a pen.', 'This is a pen.', 'She is a pretty girl.', 'There is a pen in my pocket.')

str_split(x, ' |\\.') %>% unlist()%>% tibble(A=.) %>% mutate(B=lead(A)) %>% 
    filter(A!='') %>% arrange(A,B) %>% group_by(A,B) %>% summarize(N=n())
   A      B          N
   <chr>  <chr>  <int>
 1 a      pen        3
 2 a      pretty     1
 3 girl   ""         1
 4 have   a          1
 5 I      have       1
 6 in     my         1
 7 is     a          3
 8 my     pocket     1
 9 pen    ""         2
10 pen    in         1
11 pocket ""         1
12 pretty girl       1
13 She    is         1
14 There  is         1
15 This   is         1

## 2-words
str_split(x, ' |\\.') %>% unlist()%>% tibble(A=.) %>% mutate(B=lead(A),C=lead(A,2)) %>% 
    filter(A!='',B!='') %>% arrange(A,B,C) %>% group_by(A,B,C) %>% summarize(N=n())

   A      B      C          N
   <chr>  <chr>  <chr>  <int>
 1 a      pen    ""         2
 2 a      pen    in         1
 3 a      pretty girl       1
 4 have   a      pen        1
 5 I      have   a          1
 6 in     my     pocket     1
 7 is     a      pen        2
 8 is     a      pretty     1
 9 my     pocket ""         1
10 pen    in     my         1
11 pretty girl   ""         1
12 She    is     a          1
13 There  is     a          1
14 This   is     a          1

## 3-words
str_split(x, ' |\\.') %>% unlist()%>% tibble(A=.) %>% mutate(B=lead(A),C=lead(A,2),D=lead(A,3)) %>% 
    filter(A!='',B!='',C!='') %>% arrange(A,B,C,D) %>% group_by(A,B,C,D) %>% summarize(N=n())

   A     B      C      D          N
   <chr> <chr>  <chr>  <chr>  <int>
 1 a     pen    in     my         1
 2 a     pretty girl   ""         1
 3 have  a      pen    ""         1
 4 I     have   a      pen        1
 5 in    my     pocket ""         1
 6 is    a      pen    ""         1
 7 is    a      pen    in         1
 8 is    a      pretty girl       1
 9 pen   in     my     pocket     1
10 She   is     a      pretty     1
11 There is     a      pen        1
12 This  is     a      pen        1

library(tidyverse)

df <- tibble( flg=c('AA','AA','AA','AA','AA','AA','AA','AA',
                    'BB','BB','BB','BB','BB','BB','BB','BB' ),
              x  =c(  1,   2,   2,   3,   3,   4,   4,   5,
                      1,   1,   2,   2,   2,   3,   4,   5  ) )

ggplot(df,aes(x=x,fill=flg))+geom_bar(position='identity',width=1,color='black',alpha=0.4)
ggplot(df,aes(x=x,fill=flg))+geom_histogram(position='identity',bins=5,color='black',alpha=0.4)

